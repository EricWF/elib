
add_executable(SAMPLEOBJHEADER sample_test.pass.cpp)
set_target_properties(SAMPLEOBJHEADER PROPERTIES EXCLUDE_FROM_ALL ON EXCLUDE_FROM_DEFAULT_BUILD ON)

get_directory_property(ELIB_AVAILABLE_FEATURES DIRECTORY . COMPILE_DEFINITIONS)

set(LIT_EXECUTABLE "${ELIB_ROOT_PATH}/packages/lit/lit.py" CACHE FILEPATH "Path to LLVM's lit.py.")
set(LIT_ARGS_DEFAULT "-sv" CACHE STRING "Default lit args")
set(LIT_ARGS "${LIT_ARGS_DEFAULT}")
separate_arguments(LIT_ARGS)

set(SAMPLE_OBJECT "SAMPLEOBJHEADER")

set(AUTO_GEN_COMMENT "## Autogenerated by elib configuration.\n# Do not edit!")
  
configure_file(
    ${CMAKE_CURRENT_SOURCE_DIR}/lit.site.cfg.in
    ${CMAKE_CURRENT_BINARY_DIR}/lit.site.cfg
    @ONLY)

add_custom_target(header_test_depends
    rm -rf ${CMAKE_CURRENT_LIST_DIR}/elib && cp -R ${ELIB_ROOT_PATH}/elib ${CMAKE_CURRENT_LIST_DIR})

add_custom_target(check-headers
    COMMAND ${ELIB_PYTHON_EXECUTABLE}
            ${LIT_EXECUTABLE}
            ${LIT_ARGS}
            ${CMAKE_CURRENT_BINARY_DIR}
    DEPENDS elib_python_executable header_test_depends
    COMMENT "Running header tests")
